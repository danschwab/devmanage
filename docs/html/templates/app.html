<div id="app">
    <header>
        <nav :class="{ 'open': isMenuOpen }">
            <a href="#"><img src="images/logo.png" alt="Top Shelf Exhibits" /></a>
            
            <span id="navbar">
                <template v-if="isAuthenticated">
                    <a v-for="item in navigationItems" 
                       :key="item.file"
                       :class="{ 'active': currentPage === item.file }"
                       @click="navigateToPage(item.file); isMenuOpen = false"
                       href="#">
                        {{ item.title }}
                    </a>
                </template>
                
                <button v-if="!isAuthenticated" 
                        @click="login" 
                        :disabled="isAuthLoading"
                        class="login-out-button active">
                    {{ isAuthLoading ? 'Loading...' : 'Login' }}
                </button>
                <button v-else 
                        @click="logout" 
                        :disabled="isAuthLoading"
                        class="login-out-button">
                    {{ isAuthLoading ? 'Logging out...' : `Logout (${currentUser?.name})` }}
                </button>
            </span>
            
            <button class="button-symbol gray" @click="toggleMenu">
                {{ isMenuOpen ? '×' : '≡' }}
            </button>
        </nav>
    </header>

    <div id="app-content">
        <!-- Show auth error if present -->
        <div v-if="authError" class="error-message" style="background: #ffebee; border: 1px solid #f44336; padding: 1rem; margin: 1rem; border-radius: 4px; color: #c62828;">
            <strong>Authentication Error:</strong> {{ authError }}
            <button @click="authError = null" style="float: right; background: none; border: none; font-size: 1.2em; cursor: pointer;">&times;</button>
        </div>

        <!-- Dynamic containers inserted directly here -->
        <app-container 
            v-for="container in containers" 
            :key="container.id"
            :container-id="container.id"
            :container-type="container.containerType"
            :title="container.title"
            :card-style="container.cardStyle"
            :show-close-button="container.containerType !== 'dashboard-overview'"
            :show-hamburger-menu="!container.containerType.startsWith('dashboard')"
            :show-expand-button="container.cardStyle"
            :page-location="container.pageLocation"
            :hamburger-menu-content="getHamburgerMenuContent(container.containerType)"
            :container-data="container"
            @close-container="removeContainer"
            @show-hamburger-menu="showHamburgerMenuModal"
            @expand-container="expandContainer">
            <template #content>
                <!-- Dashboard Overview Content -->
                <dashboard-overview 
                    v-if="container.containerType === 'dashboard-overview'"
                    :current-user="currentUser">
                </dashboard-overview>
                
                <!-- Dashboard Stats Content -->
                <dashboard-stats 
                    v-else-if="container.containerType === 'dashboard-stats'">
                </dashboard-stats>
                
                <!-- Dashboard Actions Content -->
                <dashboard-actions 
                    v-else-if="container.containerType === 'dashboard-actions'"
                    :navigate-to-page="navigateToPage"
                    :add-container="addContainer"
                    :show-alert="showAlert"
                    :show-confirm="showConfirm">
                </dashboard-actions>
                
                <!-- Packlist Content -->
                <packlist-content 
                    v-else-if="container.containerType === 'packlist'"
                    :show-alert="showAlert">
                </packlist-content>
                
                <!-- Inventory Content -->
                <inventory-content 
                    v-else-if="container.containerType === 'inventory'"
                    :show-alert="showAlert">
                </inventory-content>
                
                <!-- Test/Interfaces Content -->
                <interfaces-content 
                    v-else-if="container.containerType === 'test'">
                </interfaces-content>
                
                <!-- Default Content -->
                <div v-else class="default-container">
                    <p>Container {{ container.id }} loaded successfully!</p>
                    <p>Type: {{ container.containerType }}</p>
                    <p>Page: {{ currentPage }}</p>
                </div>
            </template>
        </app-container>
        
        <!-- Show message when not authenticated and no containers -->
        <div v-if="!isAuthenticated && containers.length === 0" class="welcome-message" style="text-align: center; padding: 2rem; margin: 2rem; background: #f5f5f5; border-radius: 8px;">
            <div v-if="isAuthLoading">
                <p>Initializing authentication...</p>
                <div style="font-size: 2em;">⟳</div>
            </div>
            <div v-else>
                <h2>Welcome to Top Shelf Live Inventory</h2>
                <p>Please log in to access the application.</p>
                <button @click="login" :disabled="isAuthLoading" class="login-button" style="padding: 0.5rem 1rem; font-size: 1.1em; background: #007cba; color: white; border: none; border-radius: 4px; cursor: pointer;">
                    {{ isAuthLoading ? 'Authenticating...' : 'Login with Google' }}
                </button>
            </div>
        </div>
        
        <footer>
            <p>
                &copy; 2024 Top Shelf Exhibits
                <br>
                <a href="https://topshelfexhibits.com">www.topshelfexhibits.com</a>
            </p>
        </footer>
    </div>
</div>
<!-- Modal Space -->
<div id="modal-space">
    <transition-group name="fade">
        <app-modal 
            v-for="modal in modals" 
            :key="modal.id"
            :modal-id="modal.id"
            :title="modal.title"
            :is-visible="modal.isVisible"
            @close-modal="removeModal">
            <template #content>
                <div v-if="modal.content" v-html="modal.content"></div>
                <div v-else>
                    <p>Modal {{ modal.id }} content</p>
                </div>
            </template>
        </app-modal>
    </transition-group>
</div>
