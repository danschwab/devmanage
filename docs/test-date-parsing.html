<!DOCTYPE html>
<html>
<head>
    <title>Date Parsing Test</title>
</head>
<body>
    <h1>Enhanced Date Parsing Test</h1>
    <div id="results"></div>

    <script type="module">
        import { parseDate } from './js/data_management/utils/helpers.js';

        // Test various date formats found in FakeGoogle
        const testDates = [
            '21-Jan', // Day-Month format
            '24-Jan', // Day-Month format  
            '1/13/2025', // M/D/YYYY format
            '2/3', // M/D format
            '10-Dec', // Day-Month format
            '1/7/2024', // M/D/YYYY format
            '1/28', // M/D format
            '12/13', // M/D format
            '1/9', // M/D format
            'invalid-date', // Invalid format
            '', // Empty string
            null // Null value
        ];

        const resultsDiv = document.getElementById('results');
        let html = '<h2>Test Results (defaultYear=2025):</h2><table border="1"><tr><th>Input</th><th>Parsed Result</th><th>ISO String</th></tr>';
        
        testDates.forEach(dateStr => {
            const parsed = parseDate(dateStr, true, 2025);
            html += `<tr>
                <td>${dateStr || 'null'}</td>
                <td>${parsed ? parsed.toLocaleDateString() : 'null'}</td>
                <td>${parsed ? parsed.toISOString().split('T')[0] : 'null'}</td>
            </tr>`;
        });
        
        html += '</table>';
        
        // Test the production data scenarios
        html += '<h2>Production Scenario Tests:</h2>';
        html += '<p><strong>Testing scenarios from FakeGoogle production data:</strong></p>';
        
        const productionScenarios = [
            { ship: '1/13/2025', ret: '', sStart: '21-Jan', sEnd: '24-Jan' },
            { ship: '', ret: '2/3', sStart: '21-Jan', sEnd: '24-Jan' },
            { ship: '', ret: '', sStart: '24-Jan', sEnd: '26-Jan' },
        ];
        
        html += '<table border="1"><tr><th>Ship</th><th>Return</th><th>S.Start</th><th>S.End</th><th>Computed Ship</th><th>Computed Return</th></tr>';
        
        productionScenarios.forEach(scenario => {
            let ship = parseDate(scenario.ship, true, 2025);
            let ret = parseDate(scenario.ret, true, 2025);
            
            // Apply the same logic as production-utils
            if (!ship) {
                let sStart = parseDate(scenario.sStart, true, 2025);
                ship = sStart ? new Date(sStart.getTime() - 10 * 86400000) : null;
            }
            if (!ret) {
                let sEnd = parseDate(scenario.sEnd, true, 2025);
                ret = sEnd ? new Date(sEnd.getTime() + 10 * 86400000) : null;
            }
            
            // Additional fallback logic
            if (!ship && !ret) {
                let sStart = parseDate(scenario.sStart, true, 2025);
                if (sStart) {
                    ship = new Date(sStart.getTime() - 10 * 86400000);
                    ret = new Date(sStart.getTime() + 30 * 86400000);
                }
            }
            
            if (ship && !ret) {
                ret = new Date(ship.getTime() + 30 * 86400000);
            }
            
            html += `<tr>
                <td>${scenario.ship || 'empty'}</td>
                <td>${scenario.ret || 'empty'}</td>
                <td>${scenario.sStart}</td>
                <td>${scenario.sEnd}</td>
                <td>${ship ? ship.toLocaleDateString() : 'null'}</td>
                <td>${ret ? ret.toLocaleDateString() : 'null'}</td>
            </tr>`;
        });
        
        html += '</table>';
        
        resultsDiv.innerHTML = html;
    </script>
</body>
</html>
